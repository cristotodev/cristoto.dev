---
import PageLayout from "@/layouts/Base.astro";
import { getAllPosts } from "@/data/post";
import { Icon } from "astro-icon/components";

const meta = {
	description: "Página no encontrada. Descubre tutoriales de programación, desarrollo web y tecnología en Cristotodev.",
	title: "Página no encontrada - 404",
};

// Get popular posts and categories for suggestions
const allPosts = await getAllPosts();
const recentPosts = allPosts.slice(0, 3);

const categories = [...new Set(allPosts.map(post => post.id.split('/')[0]))].slice(0, 4);
---

<PageLayout meta={meta}>
	<div class="flex flex-col items-center justify-center min-h-[60vh] text-center">
		<div class="mb-8">
			<div class="text-8xl font-bold text-accent-base mb-4">404</div>
			<h1 class="text-3xl font-semibold mb-4 text-textColor">
				Página no encontrada
			</h1>
			<p class="text-lg text-textColor/70 mb-8 max-w-md">
				Lo siento, la página que buscas no existe o ha sido movida. 
				Te ayudo a encontrar lo que necesitas.
			</p>
		</div>

		<div class="grid md:grid-cols-2 gap-8 w-full max-w-4xl">
			<!-- Popular Posts -->
			<div class="bg-special-lighter rounded-lg p-6">
				<h2 class="text-xl font-semibold mb-4 flex items-center">
					<Icon class="w-5 h-5 mr-2 text-accent-base" name="solar:star-bold" />
					Posts Populares
				</h2>
				<ul class="space-y-3">
					{recentPosts.map(post => (
						<li>
							<a 
								href={`/posts/${post.id}/`}
								class="block hover:text-accent-base transition-colors group"
							>
								<div class="font-medium group-hover:underline">
									{post.data.title}
								</div>
								<div class="text-sm text-textColor/60 mt-1">
									{post.data.description.slice(0, 80)}...
								</div>
							</a>
						</li>
					))}
				</ul>
			</div>

			<!-- Categories -->
			<div class="bg-special-lighter rounded-lg p-6">
				<h2 class="text-xl font-semibold mb-4 flex items-center">
					<Icon class="w-5 h-5 mr-2 text-accent-base" name="solar:folder-bold" />
					Categorías
				</h2>
				<div class="grid grid-cols-2 gap-3">
					{categories.map(category => (
						<a 
							href={`/posts/`}
							class="bg-accent-base/10 hover:bg-accent-base/20 rounded-lg p-3 text-center transition-colors group"
						>
							<div class="font-medium capitalize text-accent-base group-hover:text-accent-base/80">
								{category}
							</div>
						</a>
					))}
				</div>
			</div>
		</div>

		<!-- Navigation Links -->
		<div class="mt-8 flex flex-wrap gap-4 justify-center">
			<a 
				href="/"
				class="bg-accent-base text-white px-6 py-3 rounded-lg hover:bg-accent-base/90 transition-colors flex items-center"
			>
				<Icon class="w-4 h-4 mr-2" name="solar:home-bold" />
				Ir al Inicio
			</a>
			<a 
				href="/posts/"
				class="bg-special-lighter border border-accent-base/20 px-6 py-3 rounded-lg hover:bg-accent-base/10 transition-colors flex items-center"
			>
				<Icon class="w-4 h-4 mr-2" name="solar:notes-bold" />
				Ver Blog
			</a>
			<a 
				href="/contact/"
				class="bg-special-lighter border border-accent-base/20 px-6 py-3 rounded-lg hover:bg-accent-base/10 transition-colors flex items-center"
			>
				<Icon class="w-4 h-4 mr-2" name="solar:chat-line-bold" />
				Contacto
			</a>
		</div>

		<!-- Search suggestion -->
		<div class="mt-8 text-center">
			<p class="text-textColor/60 mb-4">
				¿No encuentras lo que buscas? Prueba a usar el buscador.
			</p>
			<div class="max-w-md mx-auto">
				<div class="relative">
					<input 
						type="text" 
						placeholder="Buscar tutoriales, guías..."
						class="w-full px-4 py-3 pl-10 bg-special-lighter border border-accent-base/20 rounded-lg focus:outline-none focus:border-accent-base"
						id="search-404"
					>
					<Icon class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-textColor/40" name="solar:star-bold" />
				</div>
			</div>
		</div>
	</div>
</PageLayout>

<script>
	// Simple search redirect functionality
	document.getElementById('search-404')?.addEventListener('keypress', (e) => {
		if (e.key === 'Enter') {
			const query = (e.target as HTMLInputElement).value;
			if (query.trim()) {
				window.location.href = `/posts/?search=${encodeURIComponent(query)}`;
			}
		}
	});
</script>
